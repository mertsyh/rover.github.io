<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Roverium Admin Panel</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">

<!-- Quill CSS -->
<link href="https://cdn.quilljs.com/1.3.7/quill.snow.css" rel="stylesheet">

<style>
body {
  margin: 0;
  font-family: 'Montserrat', sans-serif;
  background: linear-gradient(135deg, #050510 0%, #000000 100%);
  color: white;
  min-height: 100vh;
  overflow-x: hidden;
}

/* Arka plan */
body::before {
  content: "";
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: url("foto5.png") no-repeat center bottom;
  background-size: cover;
  opacity: 1;
  z-index: 0;
  pointer-events: none;
}

/* Header */
header {
  background: rgba(255,255,255,0.05);
  backdrop-filter: blur(10px);
  padding: 20px 50px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  z-index: 10;
}

header h1 {
  margin:0;
  font-size:1.8rem;
  color:#ffad60;
  display: flex;
  align-items: center;
  gap: 15px;
}

header h1 img {
  height: 50px;
  width:auto;
}

main {
  max-width: 900px;
  margin: 80px auto 50px;
  padding: 0 15px;
  position: relative;
  z-index: 1;
}

/* Card */
.card {
  background: rgba(255,255,255,0.1);
  backdrop-filter: blur(10px);
  border-radius: 15px;
  padding: 20px;
  margin: 0 auto 30px;
  transition: transform 0.3s, background 0.3s;
  width: 90%;
  max-width: 600px;
  box-sizing: border-box;
}
.card:hover {
  transform: translateY(-5px);
  background: rgba(255,255,255,0.15);
}

/* Inputs & Buttons */
input, button {
  display: block;
  width: 80%;
  margin: 10px auto;
  padding: 10px;
  border-radius: 10px;
  border: 0.5px solid whitesmoke;
  font-size: 1rem;
}

input {
  background: rgba(255,255,255,0.05);
  color: white;
}
input::placeholder { color: #aaa; }

button {
  cursor: pointer;
  font-weight: bold;
  transition: 0.3s;
}
button.primary { background: rgba(255,255,255,0.5); width:200px; }
button.primary:hover { background: #d2d7f7; }
button.approve { background: green; color:white; margin-top:10px; }
button.approve:hover { background: #d2d7f7; }
button.reject { background: red; color:white; margin-top:10px; }
button.reject:hover { background: #d2d7f7; }

h2 { color: #ffad60; margin-top:0; text-align:center; }

/* Responsive */
@media(max-width:768px){
  header { flex-direction: column; gap: 10px; padding: 15px; text-align:center; }
  .card { width: 95%; padding: 15px; }
  input, button { width: 90%; }
}

/* Quill içerik */
.ql-editor img {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 10px 0;
  border-radius: 10px;
}

/* Post içerikleri */
.post {
  margin-bottom: 20px;
}
.post-content {
  overflow-wrap: break-word;
}
.post-content img {
  max-width: 100%;
  height: auto;
  display: block;
  margin: 10px 0;
  border-radius: 10px;
}

/* Geçiş animasyonu */
#login-container, #signup-container {
  transition: all 0.3s ease;
}
</style>
</head>
<body>

<header>
  <h1>
    <img src="https://edizos.github.io/RoveriumWeb/images/komple_penege.png" alt="Logo">
    Roverium Admin Panel
  </h1>
</header>

<main>

  <!-- GİRİŞ -->
  <div class="card" id="login-container">
    <h2>Giriş Yap</h2>
    <input type="email" id="loginEmail" placeholder="E-posta">
    <input type="password" id="loginPassword" placeholder="Şifre">
    <button id="loginBtn" class="primary">Giriş Yap</button>
    <p style="text-align:center; color:#ccc;">Hesabın yok mu? 
      <a href="#" id="showSignup" style="color:#ffad60;">Kayıt Ol</a>
    </p>
  </div>

  <!-- KAYIT -->
  <div class="card" id="signup-container" style="display:none;">
    <h2>Kayıt Ol</h2>
    <input type="email" id="signupEmail" placeholder="E-posta">
    <input type="password" id="signupPassword" placeholder="Şifre">
    <button id="signupBtn" class="primary">Kayıt Ol</button>
    <p style="text-align:center; color:#ccc;">Zaten hesabın var mı? 
      <a href="#" id="showLogin" style="color:#ffad60;">Giriş Yap</a>
    </p>
  </div>

  <!-- YAZI EKLE -->
  <div class="card" id="newPostSection" style="display:none;">
    <h2>Yeni Yazı Ekle</h2>
    <input type="text" id="postTitle" placeholder="Başlık">
    <div id="editor" style="height: 300px; background: rgba(255,255,255,0.05); border-radius:10px; padding:10px;"></div>
    <button id="addPostBtn" class="primary">Kaydet (Pending)</button>
  </div>

  <!-- BEKLEYEN YAZILAR -->
  <div class="card" id="pendingPosts" style="display:none;">
    <h2>Bekleyen Yazılar</h2>
    <div id="postsContainer"></div>
  </div>

</main>

<!-- Quill JS -->
<script src="https://cdn.quilljs.com/1.3.7/quill.js"></script>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs, query, where, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC7wHvnllwQMrM34daOU_V58lNfnOogVYk",
  authDomain: "roverium-4f3db.firebaseapp.com",
  projectId: "roverium-4f3db",
  storageBucket: "roverium-4f3db.firebasestorage.app",
  messagingSenderId: "1063901094879",
  appId: "1:1063901094879:web:6d257de2ee99e7abfe5a6a",
  measurementId: "G-R0EHN6ECNK"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

// DOM
const loginContainer = document.getElementById('login-container');
const signupContainer = document.getElementById('signup-container');
const showSignup = document.getElementById('showSignup');
const showLogin = document.getElementById('showLogin');
const loginEmail = document.getElementById('loginEmail');
const loginPassword = document.getElementById('loginPassword');
const signupEmail = document.getElementById('signupEmail');
const signupPassword = document.getElementById('signupPassword');
const loginBtn = document.getElementById('loginBtn');
const signupBtn = document.getElementById('signupBtn');
const newPostSection = document.getElementById('newPostSection');
const postTitle = document.getElementById('postTitle');
const addPostBtn = document.getElementById('addPostBtn');
const pendingPosts = document.getElementById('pendingPosts');
const postsContainer = document.getElementById('postsContainer');

// Giriş / Kayıt geçişi
showSignup.addEventListener('click', (e) => {
  e.preventDefault();
  loginContainer.style.display = 'none';
  signupContainer.style.display = 'block';
});
showLogin.addEventListener('click', (e) => {
  e.preventDefault();
  signupContainer.style.display = 'none';
  loginContainer.style.display = 'block';
});

// Kayıt
signupBtn.addEventListener('click', async () => {
  try {
    const userCredential = await createUserWithEmailAndPassword(auth, signupEmail.value, signupPassword.value);
    const user = userCredential.user;
    await sendEmailVerification(user);
    alert(`Kayıt başarılı! Lütfen ${signupEmail.value} adresine gelen doğrulama linkini tıklayın.`);
  } catch(e) { alert(e.message); }
});

// Admin UID
const adminUID = "2pY39uMBp7doIKGalO6lOLaS6Ay2";

// Giriş
loginBtn.addEventListener('click', async () => {
  try {
    const userCredential = await signInWithEmailAndPassword(auth, loginEmail.value, loginPassword.value);
    const user = userCredential.user;

    if (!user.emailVerified) {
      alert("E-posta doğrulanmamış! Lütfen e-postanı kontrol et.");
      return;
    }

    alert("Giriş başarılı!");

    loginContainer.style.display = 'none';
    signupContainer.style.display = 'none';

    if (user.uid === adminUID) {
      alert("Admin olarak giriş yaptınız.");
      newPostSection.style.display = 'block';
      pendingPosts.style.display = 'block';
      loadPendingPosts();
    } else {
      newPostSection.style.display = 'block';
      pendingPosts.style.display = 'none';
    }

  } catch (e) { alert("Giriş hatası: " + e.message); }
});

// Quill
const quill = new Quill('#editor', {
  theme: 'snow',
  placeholder: 'Yazınızı buraya yazın...',
  modules: {
    toolbar: [
      ['bold', 'italic', 'underline', 'strike'],
      ['blockquote', 'code-block'],
      [{ 'header': 1 }, { 'header': 2 }],
      [{ 'list': 'ordered'}, { 'list': 'bullet' }],
      [{ 'color': [] }, { 'background': [] }],
      ['link', 'image'],
      ['clean']
    ]
  }
});

// Yeni yazı ekle
addPostBtn.addEventListener('click', async () => {
  const user = auth.currentUser;
  if(!user) return;

  const title = postTitle.value.trim();
  const content = quill.root.innerHTML.trim();

  if(!title || !content) {
    alert("Başlık veya içerik boş olamaz!");
    return;
  }

  await addDoc(collection(db, "posts"), {
    title: title,
    content: content,
    authorUid: user.uid,
    published: false,
    createdAt: new Date()
  });

  alert("Yazınız kaydedildi. Admin onayı bekleniyor.");
  postTitle.value = '';
  quill.setText('');
  loadPendingPosts();
});

// Bekleyen yazılar
async function loadPendingPosts() {
  postsContainer.innerHTML = '';
  const user = auth.currentUser;
  if(!user) return;

  let q = user.uid === adminUID ? query(collection(db, "posts")) :
        query(collection(db, "posts"), where("authorUid","==",user.uid));

  const snap = await getDocs(q);
  snap.forEach(docSnap => {
    const data = docSnap.data();
    const div = document.createElement('div');
    div.className = 'post';

    let dateStr = data.createdAt?.toDate ? data.createdAt.toDate().toLocaleDateString() : new Date(data.createdAt).toLocaleDateString();
    div.innerHTML = `
      <h3>${data.title}</h3>
      <div class="post-content">${data.content}</div>
      <small>• ${dateStr}</small>
    `;

    if(user.uid === adminUID){
      const approveBtn = document.createElement('button');
      approveBtn.textContent = data.published ? 'Yayınlandı' : 'Onayla';
      approveBtn.className = 'approve';
      approveBtn.disabled = data.published;
      approveBtn.onclick = async () => {
        await updateDoc(doc(db, "posts", docSnap.id), { published:true });
        loadPendingPosts();
      };

      const deleteBtn = document.createElement('button');
      deleteBtn.textContent = 'Sil';
      deleteBtn.className = 'reject';
      deleteBtn.onclick = async () => {
        if(confirm("Bu yazıyı silmek istediğine emin misin?")){
          await deleteDoc(doc(db, "posts", docSnap.id));
          loadPendingPosts();
        }
      };

      div.appendChild(approveBtn);
      div.appendChild(deleteBtn);
    }

    postsContainer.appendChild(div);
  });
}
</script>
</body>
</html>
